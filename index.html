<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Validasi Gas">
    <link rel="manifest" href="manifest.json">
    <title>Validasi Data Gas</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFA000, #FF6F00);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
            font-weight: 600;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border-left: 4px solid #28a745;
            font-size: 14px;
            font-weight: 600;
        }

        .status-bar.offline {
            border-left-color: #6c757d;
        }

        .login-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .login-box h3 {
            margin-bottom: 10px;
        }

        .user-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .google-btn {
            background: white;
            color: #444;
            border: 1px solid #ddd;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .google-btn:hover { background: #f8f9fa; }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
        }

        .logout-btn:hover { background: #c82333; }

        .legend {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .legend-item {
            display: inline-flex;
            align-items: center;
            margin-right: 20px;
            margin-bottom: 8px;
        }

        .legend-box {
            width: 25px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            border: 1px solid #ddd;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        button:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-delete { background: #dc3545; }
        .btn-delete:hover:not(:disabled) { background: #c82333; }
        .btn-export { background: #28a745; }
        .btn-export:hover:not(:disabled) { background: #218838; }
        .btn-backup { background: #17a2b8; }
        .btn-backup:hover:not(:disabled) { background: #138496; }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
        }

        .alert-error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .alert-success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }

        .data-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .data-item {
            background: white;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 5px solid #6c757d;
            transition: all 0.3s;
        }

        .data-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .data-item.duplicate-2 {
            background: #d4f4dd;
            border-left-color: #51cf66;
        }

        .data-item.duplicate-3 {
            background: #fff9db;
            border-left-color: #ffd43b;
        }

        .data-item.duplicate-4 {
            background: #ffe0e0;
            border-left-color: #ff6b6b;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .data-index {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .data-nik {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: 600;
        }

        .data-date {
            font-size: 12px;
            color: #666;
            background: #f0f0f0;
            padding: 3px 10px;
            border-radius: 10px;
        }

        .data-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge-status {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .data-item.duplicate-2 .badge-status { background: #51cf66; }
        .data-item.duplicate-3 .badge-status { background: #ffd43b; color: #333; }
        .data-item.duplicate-4 .badge-status { background: #ff6b6b; }

        .delete-item-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-item-btn:hover { background: #c82333; }

        .stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .stat-card {
            background: white;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button { flex: 1; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Validasi Data Gas</h1>
            <p class="subtitle">Sistem Pencatatan NIK Pelanggan Gas LPG</p>
            <div class="badge">Firebase Cloud Sync</div>
        </div>

        <div class="status-bar offline" id="statusBar">
            <span id="statusText">‚ö†Ô∏è Belum Login - Data hanya tersimpan lokal</span>
        </div>

        <div class="login-box" id="loginPrompt">
            <h3>‚òÅÔ∏è Sync Data ke Cloud</h3>
            <p style="margin-bottom: 15px; font-size: 14px;">Login dengan Google untuk menyimpan data di cloud</p>
            <button class="google-btn" onclick="loginGoogle()">
                Sign in with Google
            </button>
        </div>

        <div class="user-box" id="userBox" style="display: none;">
            <div>
                <div style="font-weight: 600;" id="userName">User</div>
                <div style="font-size: 12px; color: #666;" id="userEmail">email</div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <div class="legend">
            <strong>Keterangan:</strong>
            <div class="legend-item">
                <div class="legend-box" style="background: #e9ecef;"></div>
                <span>Normal (1x)</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #d4f4dd;"></div>
                <span>üü¢ Kembar 2</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #fff9db;"></div>
                <span>üü° Kembar 3</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #ffe0e0;"></div>
                <span>üî¥ Kembar 4</span>
            </div>
        </div>

        <div class="input-group">
            <label for="nikInput">Masukkan NIK KTP (16 Digit):</label>
            <input type="text" id="nikInput" placeholder="Contoh: 6472012345670001" maxlength="16">
        </div>

        <div class="btn-group">
            <button onclick="addNIK()">‚ûï Tambah NIK</button>
            <button class="btn-export" onclick="exportPDF()">üìÑ Download PDF</button>
            <button class="btn-backup" onclick="exportCSV()">üíæ Download CSV</button>
            <button class="btn-delete" onclick="clearAll()">üóëÔ∏è Hapus Semua</button>
        </div>

        <div class="alert alert-warning" id="alertWarning">
            ‚ö†Ô∏è <strong>Peringatan!</strong> NIK ini sudah muncul lebih dari 4 kali!
        </div>
        <div class="alert alert-error" id="alertError"></div>
        <div class="alert alert-success" id="alertSuccess"></div>

        <div class="stats" id="stats" style="display: none;">
            <strong>üìä Statistik:</strong>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="statTotal">0</div>
                    <div class="stat-label">Total NIK</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statUnique">0</div>
                    <div class="stat-label">NIK Unik</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statDuplicate">0</div>
                    <div class="stat-label">Ada Duplikat</div>
                </div>
            </div>
        </div>

        <h3 style="margin-top: 20px;">üìã Daftar NIK:</h3>
        <div class="data-list" id="dataList">
            <div class="empty-state">
                <p>Belum ada data NIK</p>
                <p style="font-size: 12px; margin-top: 10px;">üí° Login untuk sync ke cloud</p>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <h3>üóëÔ∏è Hapus Data NIK</h3>
            <p>Yakin hapus NIK ini?</p>
            <div style="font-family: 'Courier New'; font-size: 18px; font-weight: bold; color: #dc3545; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;" id="deleteNik"></div>
            <div class="modal-buttons">
                <button onclick="closeDeleteModal()" style="background: #6c757d;">Batal</button>
                <button onclick="confirmDelete()" style="background: #dc3545;">Hapus</button>
            </div>
        </div>
    </div>

    <script>
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAI5lsWVO0vxrcpMt1XswihGQECETHZnuE",
  authDomain: "validasi-data-gas-da13c.firebaseapp.com",
  databaseURL: "https://validasi-data-gas-da13c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "validasi-data-gas-da13c",
  storageBucket: "validasi-data-gas-da13c.firebasestorage.app",
  messagingSenderId: "833315824895",
  appId: "1:833315824895:web:5293a4b435adc1ea7e58ca",
  measurementId: "G-Y6XPE1DVVH"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        let app, auth, database;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            database = firebase.database();
        } catch (e) {
            console.error('Firebase error:', e);
        }

        let currentUser = null;
        let dataArray = [];
        let deleteIndex = -1;

        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                showUser(true);
                loadFromFirebase();
            } else {
                currentUser = null;
                showUser(false);
                loadFromLocal();
            }
        });

        function showUser(isLoggedIn) {
            if (isLoggedIn) {
                document.getElementById('loginPrompt').style.display = 'none';
                document.getElementById('userBox').style.display = 'flex';
                document.getElementById('userName').textContent = currentUser.displayName;
                document.getElementById('userEmail').textContent = currentUser.email;
                document.getElementById('statusBar').className = 'status-bar';
                document.getElementById('statusText').textContent = '‚òÅÔ∏è Online - Sync Firebase Aktif';
            } else {
                document.getElementById('loginPrompt').style.display = 'block';
                document.getElementById('userBox').style.display = 'none';
                document.getElementById('statusBar').className = 'status-bar offline';
                document.getElementById('statusText').textContent = '‚ö†Ô∏è Belum Login - Data hanya lokal';
            }
        }

        function loginGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(() => showSuccess('Berhasil login!'))
                .catch((err) => showError('Login gagal: ' + err.message));
        }

        function logout() {
            if (confirm('Yakin logout?')) {
                auth.signOut()
                    .then(() => showSuccess('Logout berhasil'))
                    .catch((err) => showError('Logout gagal'));
            }
        }

        function loadFromFirebase() {
            if (!currentUser) return;
            const ref = database.ref('users/' + currentUser.uid + '/data');
            ref.on('value', (snapshot) => {
                const data = snapshot.val();
                dataArray = data && Array.isArray(data) ? data : [];
                updateDisplay();
            });
        }

        function saveToFirebase() {
            if (!currentUser) {
                saveToLocal();
                return;
            }
            const ref = database.ref('users/' + currentUser.uid + '/data');
            ref.set(dataArray);
        }

        function loadFromLocal() {
            const saved = localStorage.getItem('gas_data');
            dataArray = saved ? JSON.parse(saved) : [];
            updateDisplay();
        }

        function saveToLocal() {
            localStorage.setItem('gas_data', JSON.stringify(dataArray));
        }

        function addNIK() {
            const input = document.getElementById('nikInput');
            const val = input.value.trim().replace(/\s/g, '');

            hideAlerts();

            if (!val) {
                showError('Masukkan NIK!');
                return;
            }

            if (val.length !== 16 || !/^\d+$/.test(val)) {
                showError('NIK harus 16 digit angka!');
                return;
            }

            const count = dataArray.filter(item => item.nik === val).length;
            if (count >= 4) {
                document.getElementById('alertWarning').classList.add('show');
                input.value = '';
                return;
            }

            dataArray.push({
                nik: val,
                tanggal: new Date().toISOString().split('T')[0]
            });

            input.value = '';
            saveToFirebase();
            updateDisplay();
            showSuccess('NIK berhasil ditambahkan!');
        }

        function updateDisplay() {
            const list = document.getElementById('dataList');
            const stats = document.getElementById('stats');

            const freq = {};
            dataArray.forEach(item => {
                freq[item.nik] = (freq[item.nik] || 0) + 1;
            });

            if (dataArray.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>Belum ada data NIK</p></div>';
                stats.style.display = 'none';
                return;
            }

            list.innerHTML = '';
            dataArray.forEach((item, idx) => {
                const count = freq[item.nik];
                let className = '';
                let badge = '1x';

                if (count === 2) { className = 'duplicate-2'; badge = 'Kembar 2'; }
                else if (count === 3) { className = 'duplicate-3'; badge = 'Kembar 3'; }
                else if (count === 4) { className = 'duplicate-4'; badge = 'Kembar 4'; }

                const div = document.createElement('div');
                div.className = 'data-item ' + className;
                div.innerHTML = `
                    <div class="data-row">
                        <div class="data-left">
                            <span class="data-index">#${idx + 1}</span>
                            <span class="data-nik">${formatNIK(item.nik)}</span>
                            <span class="data-date">üìÖ ${formatDate(item.tanggal)}</span>
                        </div>
                        <div class="data-right">
                            <span class="badge-status">${badge}</span>
                            <button class="delete-item-btn" onclick="showDeleteModal(${idx})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });

            stats.style.display = 'block';
            document.getElementById('statTotal').textContent = dataArray.length;
            document.getElementById('statUnique').textContent = Object.keys(freq).length;
            document.getElementById('statDuplicate').textContent = Object.values(freq).filter(c => c > 1).length;
        }

        function formatNIK(nik) {
            return nik.replace(/(\d{4})(\d{4})(\d{4})(\d{4})/, '$1 $2 $3 $4');
        }

        function formatDate(dateStr) {
            const d = new Date(dateStr);
            const months = ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'];
            return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
        }

        function showDeleteModal(idx) {
            deleteIndex = idx;
            document.getElementById('deleteNik').textContent = formatNIK(dataArray[idx].nik);
            document.getElementById('deleteModal').classList.add('show');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('show');
            deleteIndex = -1;
        }

        function confirmDelete() {
            if (deleteIndex === -1) return;
            dataArray.splice(deleteIndex, 1);
            closeDeleteModal();
            saveToFirebase();
            updateDisplay();
            showSuccess('NIK terhapus!');
        }

        function clearAll() {
            if (dataArray.length === 0) {
                showError('Tidak ada data!');
                return;
            }
            if (confirm('Hapus semua data?')) {
                dataArray = [];
                saveToFirebase();
                updateDisplay();
                showSuccess('Semua terhapus!');
            }
        }

        function exportCSV() {
            if (dataArray.length === 0) {
                showError('Tidak ada data!');
                return;
            }

            const freq = {};
            dataArray.forEach(item => {
                freq[item.nik] = (freq[item.nik] || 0) + 1;
            });

            let csv = 'No,Tanggal,NIK,Jumlah,Status\n';
            const seen = new Set();
            let no = 1;

            dataArray.forEach(item => {
                if (!seen.has(item.nik)) {
                    const count = freq[item.nik];
                    let status = 'Normal';
                    if (count === 2) status = 'Kembar 2';
                    else if (count === 3) status = 'Kembar 3';
                    else if (count === 4) status = 'Kembar 4';

                    csv += `${no},${item.tanggal},${item.nik},${count}x,${status}\n`;
                    seen.add(item.nik);
                    no++;
                }
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Backup_Gas_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            showSuccess('CSV berhasil diunduh!');
        }

        function exportPDF() {
            if (dataArray.length === 0) {
                showError('Tidak ada data!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('LAPORAN VALIDASI DATA GAS', 105, 20, { align: 'center' });

            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            const today = new Date().toLocaleString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            doc.text('Tanggal: ' + today, 105, 30, { align: 'center' });

            if (currentUser) {
                doc.text('Petugas: ' + currentUser.displayName, 105, 37, { align: 'center' });
            }

            const freq = {};
            dataArray.forEach(item => {
                freq[item.nik] = (freq[item.nik] || 0) + 1;
            });

            const tableData = [];
            const seen = new Set();

            dataArray.forEach(item => {
                if (!seen.has(item.nik)) {
                    const count = freq[item.nik];
                    let status = 'Normal';
                    if (count === 2) status = 'Kembar 2';
                    else if (count === 3) status = 'Kembar 3';
                    else if (count === 4) status = 'Kembar 4';

                    tableData.push([
                        tableData.length + 1,
                        item.tanggal,
                        formatNIK(item.nik),
                        count + 'x',
                        status
                    ]);
                    seen.add(item.nik);
                }
            });

            doc.autoTable({
                startY: 45,
                head: [['No', 'Tanggal', 'NIK', 'Jumlah', 'Status']],
                body: tableData,
                theme: 'grid',
                headStyles: { fillColor: [102, 126, 234], fontSize: 11, fontStyle: 'bold' },
                styles: { fontSize: 10, cellPadding: 5, font: 'courier' },
                columnStyles: {
                    0: { cellWidth: 15, halign: 'center' },
                    1: { cellWidth: 30, halign: 'center' },
                    2: { cellWidth: 70 },
                    3: { cellWidth: 20, halign: 'center' },
                    4: { cellWidth: 35, halign: 'center' }
                },
                didParseCell: function(data) {
                    if (data.section === 'body' && data.column.index === 4) {
                        const status = data.cell.raw;
                        if (status === 'Kembar 2') data.cell.styles.fillColor = [212, 244, 221];
                        else if (status === 'Kembar 3') data.cell.styles.fillColor = [255, 249, 219];
                        else if (status === 'Kembar 4') data.cell.styles.fillColor = [255, 224, 224];
                    }
                }
            });

            const finalY = doc.lastAutoTable.finalY + 15;
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text('RINGKASAN:', 14, finalY);
            doc.setFont(undefined, 'normal');
            doc.text(`Total NIK: ${dataArray.length}`, 14, finalY + 7);
            doc.text(`NIK Unik: ${Object.keys(freq).length}`, 14, finalY + 14);

            const filename = `Laporan_Gas_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(filename);
            showSuccess('PDF berhasil diunduh!');
        }

        function showSuccess(msg) {
            hideAlerts();
            const el = document.getElementById('alertSuccess');
            el.textContent = '‚úÖ ' + msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        function showError(msg) {
            hideAlerts();
            const el = document.getElementById('alertError');
            el.textContent = '‚ùå ' + msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        function hideAlerts() {
            document.querySelectorAll('.alert').forEach(el => el.classList.remove('show'));
        }

        document.getElementById('nikInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addNIK();
        });

        window.addEventListener('load', () => {
            if (!currentUser) loadFromLocal();
        });
    </script>
</body>
</html>
